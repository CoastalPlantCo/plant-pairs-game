<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plant Pairs | Coastal Plant Company</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --brand-bg: #fbf7ea;
      --brand-text: #0a4d4d;
      --popup-shadow: rgba(0,0,0,0.3);
    }
    body {
      margin: 0;
      font-family: 'Helvetica Neue', sans-serif;
      background: var(--brand-bg);
      color: var(--brand-text);
      text-align: center;
    }
    .hidden { display: none; }

    /* Popups */
    .popup {
      position: fixed;
      top:50%; left:50%;
      transform: translate(-50%,-50%) scale(0.9);
      z-index: 9999;
      background: #fff;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 20px 40px var(--popup-shadow);
      opacity: 0;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      width: 90%; max-width: 400px;
    }
    .popup.show {
      transform: translate(-50%,-50%) scale(1);
      opacity: 1;
    }
    .popup .close-btn {
      position: absolute; top:1rem; right:1rem;
      font-size: 1.4rem; font-weight: bold;
      background: none; border: none;
      color: var(--brand-text);
      cursor: pointer;
    }
    .popup h3 { margin-top: 0; font-size: 1.5rem; }
    .spinner {
      margin: 1rem auto; width: 40px; height: 40px;
      border: 4px solid var(--brand-text);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Buttons */
    button {
      background: var(--brand-text);
      color: #fff;
      padding: 0.75rem 1.5rem;
      border: none; border-radius: 0.5rem;
      font-size: 1rem; cursor: pointer;
      margin: 0.5rem;
      box-shadow: 0 4px 8px var(--popup-shadow);
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.05); }

    /* GAME BOARD: 3 columns on small, 6 on wide, capped at 1080px */
    #game-board {
      display: grid;
      grid-template-columns: repeat(3,1fr);
      gap: 20px;
      margin: 3rem auto;
      padding: 0 1rem;
      max-width: 1080px;
    }
    @media (min-width: 768px) {
      #game-board {
        grid-template-columns: repeat(6,1fr);
      }
    }

    /* Cards */
    .card {
      perspective: 1000px;
      width: 100%; aspect-ratio: 1/1;
      overflow: hidden;
    }
    .card-inner {
      width: 100%; height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card .front, .card .back {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden;
      background-size: cover; background-position: center;
      border-radius: 1.5rem;
    }
    .card .front { transform: rotateY(180deg); z-index: 2; }
    .card .back  { transform: rotateY(0deg);   z-index: 1; }
  </style>
</head>
<body>

  <!-- Main Game Container -->
  <div id="game-container">
    <div style="margin-top:1rem;font-size:1.25rem;font-weight:bold;">
      Score: <span id="score">0</span> |
      Streak: <span id="streak">0</span> |
      Misses: <span id="misses">0</span> |
      Matches: <span id="matched">0</span> |
      Time: <span id="elapsed">0</span>s
    </div>
    <div id="game-board"></div>
    <div style="margin-top:2rem;">
      <button id="restart-button">Restart Game</button>
      <button id="game-howto">How to Play</button>
      <button id="leaderboard-button">View Leaderboard</button>
    </div>
  </div>

  <!-- How to Play Popup -->
  <div id="howtoplay-popup" class="popup hidden">
    <button class="close-btn" onclick="closeAllPopups()">&times;</button>
    <h3>How to Play</h3>
    <ul style="text-align:left; list-style:disc inside; margin:1rem 0;">
      <li>Flip two cards to find a matching pair.</li>
      <li>The game ends once all pairs are matched.</li>
      <li>Avoid mismatches to keep your streak bonus.</li>
      <li>Finish quickly to maximize your time bonus.</li>
    </ul>
    <h4 style="margin-top:1rem;text-align:left;">Scoring:</h4>
    <ul style="text-align:left; list-style:disc inside; margin:0 0 1rem;">
      <li><strong>Match found:</strong> +100 points</li>
      <li><strong>Streak bonus:</strong> +25 per consecutive match</li>
      <li><strong>Mismatch:</strong> −20 points</li>
      <li><strong>Time bonus:</strong> Starts at 900, −3 per second</li>
    </ul>
    <button onclick="closeAllPopups()">Close</button>
  </div>

  <!-- Loading Popup -->
  <div id="loading-popup" class="popup hidden">
    <div class="spinner"></div>
    <p>Loading leaderboard...</p>
  </div>

  <!-- Leaderboard Popup -->
  <div id="leaderboard-popup" class="popup hidden">
    <button class="close-btn" onclick="closeAllPopups()">&times;</button>
    <h3>Leaderboard</h3>
    <div id="leaderboard-entries" style="margin-top:1rem;"></div>
    <button onclick="closeAllPopups()">Close</button>
  </div>

  <!-- You Win Popup -->
  <div id="win-popup" class="popup hidden">
    <button class="close-btn" onclick="closeAllPopups()">&times;</button>
    <h3>You Win!</h3>
    <p>Your Score: <span id="final-score">0</span></p>
    <p id="breakdown" style="white-space:nowrap;font-weight:bold;">
      Matches: <span id="final-matches"></span> |
      Streak: <span id="final-streak"></span> |
      Misses: <span id="final-misses"></span> |
      Time: <span id="final-time"></span>s
    </p>
    <div style="display:flex;gap:0.5rem;align-items:center;margin-top:1rem;">
      <input id="player-name-input" type="text"
             placeholder="Your name or nickname"
             style="flex:1;padding:0.5rem;" />
      <button id="generate-name-button" style="padding:0.5rem;font-size:0.9rem;">
        Generate Random Name
      </button>
    </div>
    <input id="player-email-input" type="email"
           placeholder="Your email (for prize notifications & exclusive offers)"
           style="width:100%;padding:0.5rem;margin:0.5rem 0;" />
    <label style="display:block;margin-bottom:1rem;">
      <input id="optin-checkbox" type="checkbox" />
      Sign me up to receive promotions, care tips & more!
    </label>
    <button id="submit-score-button">Submit Score</button>
    <button onclick="initGame()">Play Again</button>
  </div>

  <!-- Submission Confirmation -->
  <div id="submit-confirmation-popup" class="popup hidden">
    <button class="close-btn" onclick="closeAllPopups()">&times;</button>
    <h3>Score Submitted!</h3>
    <p>Your score has been added to the leaderboard.</p>
    <button onclick="showLeaderboard()">View Leaderboard</button>
    <button onclick="closeAllPopups()">Close</button>
  </div>

  <!-- Submission Error -->
  <div id="submit-error-popup" class="popup hidden">
    <button class="close-btn" onclick="closeAllPopups()">&times;</button>
    <h3>Submission Failed</h3>
    <p>We couldn't submit your score. Please check your network and try again.</p>
    <button onclick="closeAllPopups()">Close</button>
  </div>

  <script>
    const LEADERBOARD_URL =
      "https://script.google.com/macros/s/AKfycbw1EyWeWyyQq7_mZ_NOdyzp_ITAv5MMQLx-gssjtD9d4gtfq0EYUOBpmn8_gMCWNDVT/exec";

    const images = [
      /* your 19 front-card URLs here */
    ];
    const adjectives = [ /* … */ ];
    const nouns      = [ /* … */ ];

    let flippedCards = [], matched = 0, score = 0, streak = 0, misses = 0;
    let startTime = null, timer = null, currentPlayerName = null;

    function shuffle(a){ /* … same shuffle … */ }
    function closeAllPopups(){ /* … */ }
    function openPopup(id){ /* … */ }

    function initGame(){
      /* pick 9 unique, double, shuffle, reset stats, render cards */
    }
    function flipCard(card){ /* … start timer on first flip, handle match/mismatch … */ }
    function updateStats(){ /* … update score/streak/etc … */ }
    function showLeaderboard(){ /* … JSONP fetch + render … */ }
    function handleWin(){ /* … show win popup with delay … */ }
    function generateNickname(){ /* … */ }
    async function submitScore(name,score,email,optedIn){ /* … no-cors post … */ }

    document.addEventListener("DOMContentLoaded",()=>{
      initGame();
      document.getElementById("restart-button").onclick = initGame;
      document.getElementById("game-howto").onclick    = ()=>openPopup("howtoplay-popup");
      document.getElementById("leaderboard-button").onclick = showLeaderboard;
      document.getElementById("generate-name-button").onclick = generateNickname;
      document.getElementById("submit-score-button").onclick = ()=>{
        const n = document.getElementById("player-name-input").value.trim();
        const e = document.getElementById("player-email-input").value.trim();
        const o = document.getElementById("optin-checkbox").checked;
        submitScore(n,score,e,o);
      };
    });
  </script>
</body>
</html>
